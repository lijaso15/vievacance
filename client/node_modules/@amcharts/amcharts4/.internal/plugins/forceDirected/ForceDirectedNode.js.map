{"version":3,"file":"ForceDirectedNode.js","sourceRoot":"","sources":["../../../../../src/.internal/plugins/forceDirected/ForceDirectedNode.ts"],"names":[],"mappings":"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","sourcesContent":["/**\r\n * Module that defines everything related to building ForceDirectedNodes.\r\n * \r\n * It is a container which has ForceDirectedNode element which is a RoundedRectangle.\r\n */\r\n\r\n/**\r\n * ============================================================================\r\n * IMPORTS\r\n * ============================================================================\r\n * @hidden\r\n */\r\nimport { Container, IContainerProperties, IContainerAdapters, IContainerEvents } from \"../../core/Container\";\r\nimport { registry } from \"../../core/Registry\";\r\nimport { Circle } from \"../../core/elements/Circle\";\r\nimport { Label } from \"../../core/elements/Label\";\r\nimport { ForceDirectedSeriesDataItem } from \"./ForceDirectedSeries\";\r\nimport { InterfaceColorSet } from \"../../core/utils/InterfaceColorSet\";\r\nimport * as $type from \"../../core/utils/Type\";\r\n\r\n/**\r\n * ============================================================================\r\n * REQUISITES\r\n * ============================================================================\r\n * @hidden\r\n */\r\n\r\n/**\r\n * Defines properties for [[ForceDirectedNode]].\r\n */\r\nexport interface IForceDirectedNodeProperties extends IContainerProperties { }\r\n\r\n/**\r\n * Defines events for [[ForceDirectedNode]].\r\n */\r\nexport interface IForceDirectedNodeEvents extends IContainerEvents { }\r\n\r\n/**\r\n * Defines adapters for [[ForceDirectedNode]].\r\n *\r\n * @see {@link Adapter}\r\n */\r\nexport interface IForceDirectedNodeAdapters extends IContainerAdapters, IForceDirectedNodeProperties { }\r\n\r\n\r\n/**\r\n * ============================================================================\r\n * MAIN CLASS\r\n * ============================================================================\r\n * @hidden\r\n */\r\n\r\n/**\r\n * Class used to creates [[ForceDirectedNode]] elements (circles).\r\n *\r\n * @see {@link IForceDirectedNodeEvents} for a list of available events\r\n * @see {@link IForceDirectedNodeAdapters} for a list of available Adapters\r\n * @since 4.3.8\r\n * @important\r\n */\r\nexport class ForceDirectedNode extends Container {\r\n\r\n\t/**\r\n\t * Defines available properties.\r\n\t */\r\n\tpublic _properties!: IForceDirectedNodeProperties;\r\n\r\n\t/**\r\n\t * Defines available adapters.\r\n\t */\r\n\tpublic _adapter!: IForceDirectedNodeAdapters;\r\n\r\n\t/**\r\n\t * Defines available events.\r\n\t */\r\n\tpublic _events!: IForceDirectedNodeEvents;\r\n\r\n\t/**\r\n\t * A node's [[Circle]] element.\r\n\t */\r\n\tpublic circle: Circle;\r\n\r\n\t/**\r\n\t * A [[Circle]] element for node's outline. This outline is used on nodes\r\n\t * that have children.\r\n\t */\r\n\tpublic outerCircle: Circle;\r\n\r\n\t/**\r\n\t * Related data item.\r\n\t */\r\n\tpublic _dataItem: ForceDirectedSeriesDataItem;\r\n\r\n\t/**\r\n\t * Node's [[Label]] element.\r\n\t */\r\n\tpublic label: Label;\r\n\r\n\t/**\r\n\t * Constructor\r\n\t */\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tthis.className = \"ForceDirectedNode\";\r\n\r\n\t\t//this.isMeasured = true; // for correct position of the tooltip\r\n\t\tthis.applyOnClones = true;\r\n\t\tthis.togglable = true;\r\n\t\tthis.draggable = true;\r\n\t\tthis.setStateOnChildren = true;\r\n\r\n\t\tthis.isActive = false;\r\n\r\n\t\tthis.events.on(\"dragstart\", () => {\r\n\t\t\tif (this.dataItem.component) {\r\n\t\t\t\tthis.dataItem.component.nodeDragStarted();\r\n\t\t\t}\r\n\t\t}, this, false);\r\n\r\n\t\tthis.events.on(\"drag\", () => {\r\n\t\t\tthis.updateSimulation();\r\n\t\t}, this, false);\r\n\r\n\t\tlet outerCircle = this.createChild(Circle);\r\n\t\touterCircle.shouldClone = false;\r\n\t\touterCircle.strokeWidth = 2;\r\n\r\n\t\tlet bgColor = new InterfaceColorSet().getFor(\"background\");\r\n\t\touterCircle.fill = bgColor;\r\n\t\tthis.outerCircle = outerCircle;\r\n\r\n\t\tlet hoverState = outerCircle.states.create(\"hover\");\r\n\t\thoverState.properties.scale = 1.1;\r\n\r\n\t\tlet outerActiveState = outerCircle.states.create(\"active\");\r\n\t\touterActiveState.properties.scale = 1.1;\r\n\t\touterActiveState.properties.visible = true;\r\n\r\n\t\tlet activeHoverState = outerCircle.states.create(\"hoverActive\");\r\n\t\tactiveHoverState.properties.scale = 1;\r\n\r\n\t\tlet circle = this.createChild(Circle);\r\n\r\n\t\tlet activeState = circle.states.create(\"active\");\r\n\t\tactiveState.properties.visible = true;\r\n\r\n\t\tcircle.shouldClone = false;\r\n\t\tcircle.interactionsEnabled = false;\r\n\t\tcircle.hiddenState.properties.radius = 0.01;\r\n\t\tcircle.events.on(\"validated\", this.updateSimulation, this, false)\r\n\t\tcircle.hiddenState.properties.visible = true;\r\n\r\n\r\n\t\tthis.circle = circle;\r\n\r\n\t\tthis.addDisposer(outerCircle.events.on(\"validated\", this.updateLabelSize, this, false));\r\n\r\n\t\tthis._disposers.push(this.circle);\r\n\r\n\t\tlet label = this.createChild(Label);\r\n\t\tlabel.shouldClone = false;\r\n\t\tlabel.horizontalCenter = \"middle\";\r\n\t\tlabel.verticalCenter = \"middle\";\r\n\t\tlabel.fill = bgColor;\r\n\t\tlabel.strokeOpacity = 0;\r\n\t\tlabel.interactionsEnabled = false;\r\n\t\tlabel.textAlign = \"middle\";\r\n\t\tlabel.textValign = \"middle\";\r\n\t\tthis.label = label;\r\n\r\n\t\tthis.adapter.add(\"tooltipY\", (y, target) => {\r\n\t\t\treturn -target.circle.pixelRadius;\r\n\t\t})\r\n\t}\r\n\r\n\t/**\r\n\t * @ignore\r\n\t */\r\n\tprotected updateLabelSize() {\r\n\t\tif (this.label.text) {\r\n\t\t\tlet circle = this.circle;\r\n\t\t\tlet radius = circle.pixelRadius;\r\n\r\n\t\t\tlet ds = circle.defaultState;\r\n\t\t\tlet dsRadius = ds.properties.radius\r\n\t\t\tif ($type.isNumber(dsRadius)) {\r\n\t\t\t\tradius = dsRadius;\r\n\t\t\t}\r\n\r\n\t\t\tthis.label.width = 2 * radius;\r\n\t\t\tthis.label.height = 2 * radius;\r\n\t\t}\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * Copies all parameters from another [[ForceDirectedNode]].\r\n\t *\r\n\t * @param source Source ForceDirectedNode\r\n\t */\r\n\tpublic copyFrom(source: this) {\r\n\t\tsuper.copyFrom(source);\r\n\t\tif (this.circle) {\r\n\t\t\tthis.circle.copyFrom(source.circle);\r\n\t\t}\r\n\t\tif (this.label) {\r\n\t\t\tthis.label.copyFrom(source.label);\r\n\t\t}\r\n\t\tif (this.outerCircle) {\r\n\t\t\tthis.outerCircle.copyFrom(source.outerCircle);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Sets node as \"active\" (expanded).\r\n\t * \r\n\t * @ignore\r\n\t * @param  value  Active or not?\r\n\t */\r\n\tpublic setActive(value: boolean) {\r\n\t\tsuper.setActive(value);\r\n\r\n\t\tlet dataItem = this.dataItem;\r\n\r\n\t\tif (dataItem) {\r\n\r\n\t\t\tlet children = dataItem.children;\r\n\r\n\t\t\tif (value && children && !dataItem.childrenInited) {\r\n\t\t\t\tdataItem.component.initNode(dataItem);\r\n\t\t\t\tdataItem.component.updateNodeList();\r\n\t\t\t}\r\n\r\n\t\t\tif (value) {\r\n\t\t\t\tif (children) {\r\n\t\t\t\t\tchildren.each((child) => {\r\n\t\t\t\t\t\tchild.node.show();\r\n\t\t\t\t\t\tchild.node.interactionsEnabled = true;\r\n\t\t\t\t\t\tif (child.parentLink) {\r\n\t\t\t\t\t\t\tchild.parentLink.show();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tchild.node.isActive = true;\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t\tdataItem.dispatchVisibility(true);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tif (children) {\r\n\t\t\t\t\tchildren.each((child) => {\r\n\t\t\t\t\t\tif (child.parentLink) {\r\n\t\t\t\t\t\t\tchild.parentLink.hide();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tchild.node.isActive = false;\r\n\t\t\t\t\t\tchild.node.interactionsEnabled = false;\r\n\r\n\t\t\t\t\t\tchild.node.hide();\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t\tdataItem.dispatchVisibility(false);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis.updateSimulation();\r\n\t}\r\n\r\n\t/**\r\n\t * @ignore\r\n\t * @todo description\r\n\t */\r\n\tprotected updateSimulation() {\r\n\t\tlet dataItem = this.dataItem;\r\n\t\tif (dataItem && dataItem.component) {\r\n\t\t\tdataItem.component.restartSimulation();\r\n\t\t}\r\n\t}\r\n}\r\n\r\n/**\r\n * Register class in system, so that it can be instantiated using its name from\r\n * anywhere.\r\n *\r\n * @ignore\r\n */\r\nregistry.registeredClasses[\"ForceDirectedNode\"] = ForceDirectedNode;"]}